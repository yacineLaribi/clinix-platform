
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{challenge.title}} - CLINIX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            border: "hsl(214.3 31.8% 91.4%)",
            input: "hsl(214.3 31.8% 91.4%)",
            ring: "hsl(221.2 83.2% 53.3%)",
            background: "hsl(0 0% 100%)",
            foreground: "hsl(222.2 84% 4.9%)",
            primary: {
              DEFAULT: "hsl(221.2 83.2% 53.3%)",
              foreground: "hsl(210 40% 98%)",
            },
            secondary: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(222.2 47.4% 11.2%)",
            },
            muted: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(215.4 16.3% 46.9%)",
            },
            accent: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(222.2 47.4% 11.2%)",
            },
            destructive: {
              DEFAULT: "hsl(0 84.2% 60.2%)",
              foreground: "hsl(210 40% 98%)",
            },
            blue: {
              600: "#2563eb",
            },
            green: {
              50: "#f0fdf4",
              200: "#bbf7d0",
              800: "#166534",
            },
          },
          borderRadius: {
            lg: "0.5rem",
            md: "calc(0.5rem - 2px)",
            sm: "calc(0.5rem - 4px)",
          },
        },
      },
    };
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-background text-foreground">
  <div class="flex min-h-screen flex-col">
    <header class="sticky top-0 z-50 w-full border-b bg-background">
      <div class="container mx-auto flex h-16 items-center justify-between px-4">
        <div class="flex items-center gap-6">
          <a href="{% url "core:index" %}" class="flex items-center gap-2">
            <span class="font-bold">CLINIX</span>
          </a>
          <nav class="hidden md:flex gap-6">
            <a href="{% url "core:challenges" %}" class="text-sm font-medium text-foreground transition-colors hover:text-primary">
              Challenges
            </a>
            <a href="{% url "core:profile" %}" class="text-sm font-medium text-muted-foreground transition-colors hover:text-primary">
              Profile
            </a>
          </nav>
        </div>
        <div class="flex items-center gap-2">
          <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10 md:hidden" id="mobile-menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <line x1="4" x2="20" y1="12" y2="12"></line>
              <line x1="4" x2="20" y1="6" y2="6"></line>
              <line x1="4" x2="20" y1="18" y2="18"></line>
            </svg>
          </button>
          
          <div class="relative">
            <button class="inline-flex items-center justify-center rounded-full h-10 w-10 overflow-hidden border border-input bg-background" id="user-menu-button">
              <span class="font-medium text-sm">JS</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="hidden md:hidden" id="mobile-menu">
        <div class="space-y-1 px-4 py-3 border-t">
          <a href="challenges.html" class="block text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-2">
            Challenges
          </a>
          <a href="leaderboard.html" class="block text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-2">
            Leaderboard
          </a>
          <a href="team.html" class="block text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-2">
            Team
          </a>
          <a href="profile.html" class="block text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-2">
            Profile
          </a>
          <a href="index.html" class="block text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-2">
            Sign out
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="container mx-auto py-8 px-4">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-3xl font-bold tracking-tight">{{challenge.title}}</h1>
            <div class="flex items-center gap-2 mt-2">
              <span class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary text-primary-foreground hover:bg-primary/80">{{challenge.type}}</span>
              <span class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground">{{challenge.points}} pts</span>
            </div>
          </div>
          <a href="{% url "core:challenges" %}">
            <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">Back to Challenges</button>
          </a>
        </div>

        <div class="space-y-4">
          <div class="border-b">
            <div class="flex">
              <button id="tab-case" class="px-4 py-2 text-sm font-medium text-center bg-background border-b-2 border-primary" onclick="showTab('case')">Case Description</button>
              <button id="tab-hints" class="px-4 py-2 text-sm font-medium text-center" onclick="showTab('hints')">Hints</button>
              <button id="tab-submission" class="px-4 py-2 text-sm font-medium text-center" onclick="showTab('submission')">Submission</button>
            </div>
          </div>

          <div id="content-case" class="mt-4">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="text-2xl font-semibold leading-none tracking-tight">Case Details</h3>
                <p class="text-sm text-muted-foreground">Read the case carefully and analyze the symptoms</p>
              </div>
              <div class="p-6 pt-0 space-y-4">
                  {{challenge.description}}
              </div>
            </div>
          </div>

          <div id="content-hints" class="mt-4 hidden">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="text-2xl font-semibold leading-none tracking-tight">Available Hints</h3>
                <p class="text-sm text-muted-foreground">Request medical imaging to help with your diagnosis</p>
              </div>
              <div class="p-6 pt-0">
                <div class="grid gap-4 md:grid-cols-3">

                  {% if hints %}
                    {% for hint in hints %}
                      <div class="rounded-lg border border-dashed bg-card text-card-foreground shadow-sm">
                        <div class="flex flex-col space-y-1.5 p-6 pb-2">
                          <h3 class="text-lg font-semibold leading-none tracking-tight">{{hint.title}}</h3>
                        </div>
                        <div class="p-6 pt-0 text-sm text-muted-foreground">
                          {{hint.title}}
                        </div>
                        <div class="p-6 pt-0">
                          <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 w-full" onclick="showHint({{hint.id}},'{{hint.title}}')">
                            Request {{hint.title}}
                          </button>
                        </div>
                      </div>

                    {% endfor %}
                  {% else %}
                    <div class="rounded-lg border border-dashed bg-card text-card-foreground shadow-sm">
                      <div class="flex flex-col space-y-1.5 p-6 pb-2">
                        <h3 class="text-lg font-semibold leading-none tracking-tight">No hints available</h3>
                      </div>
                      <div class="p-6 pt-0 text-sm text-muted-foreground">
                        No hints are available for this case.
                      </div>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>

          <div id="content-submission" class="mt-4 hidden">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="text-2xl font-semibold leading-none tracking-tight">Submit Your Diagnosis</h3>
                <p class="text-sm text-muted-foreground">
                  Provide your diagnosis and treatment plan based on the case information and any hints you've requested
                </p>
              </div>
              <div class="p-6 pt-0">
                {% if not is_submitted %}
                  <div id="submission-form" >
                    <form class="space-y-4" name="submission-form" method="POST">
                      {% csrf_token %}
                      <div class="space-y-2">
                        <h3 class="font-semibold">Diagnosis</h3>
                        <textarea id="diagnosis" name="diagnosis" placeholder="Enter your diagnosis here..." class="flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" required></textarea>
                      </div>

                      <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 w-full">
                        Submit Solution
                      </button>
                    </form>
                  </div>
                
                {% else %}
                <div id="submission-result" class="space-y-6">
                  <div class="rounded-lg bg-blue-50 p-6 text-blue-800 border border-blue-200">
                    <div class="flex items-center gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="h-5 w-5">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                      </svg>
                      <h3 class="font-bold text-lg">Diagnosis Submitted!</h3>
                    </div>
                    <p class="mt-2">
                      Your diagnosis has been successfully submitted. You will receive feedback shortly.
                      
                    </p>
                    <div class="mt-4 pt-4 border-t border-green-200">
                      <p class="font-medium">Points To Earn: {{challenge.points}} points</p>
                    </div>
                  </div>

                </div>
                {% endif %}
                {% comment %} ! Submission Results Here {% endcomment %}


              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div id="hint-modal" class="fixed inset-0 z-50 hidden bg-black/50 flex items-center justify-center">
      <div class="bg-background rounded-lg max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto">
        <div class="p-6 border-b">
          <div class="flex items-center justify-between">
            <h3 id="hint-title" class="text-xl font-semibold"></h3>
            <button onclick="closeHintModal()" class="rounded-full p-1 hover:bg-muted">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <p class="text-sm text-muted-foreground">Analyze these results carefully to help with your diagnosis</p>
        </div>

        <div class="p-6">


          {% for hint in hints %}
              <div id="hint-{{hint.title}}" class="space-y-4 hidden">
                {% if hint.image %}
                  <img src="{{ hint.image.url }}" alt="{{ hint.title }} Results" class="w-full">
                  </div>
                {% endif %}
                <div class="text-sm">
                  <p class="font-medium" id="hint-title">{{ hint.title }} Findings:</p>
                  <p id="hint-body">{{ hint.hint_text }}</p>
                </div>
              </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <footer class="border-t py-6">
      <div class="container mx-auto flex flex-col items-center justify-between gap-4 md:flex-row px-4">
        <p class="text-sm text-muted-foreground">Â© 2025 CLINIX. All rights reserved.</p>
        <nav class="flex gap-4 text-sm text-muted-foreground">
          <a href="#" class="hover:underline">About</a>
          <a href="#" class="hover:underline">Contact</a>
          <a href="#" class="hover:underline">Privacy</a>
          <a href="#" class="hover:underline">Terms</a>
        </nav>
      </div>
    </footer>
  </div>

  <script>
    // Mobile menu toggle
    document.getElementById('mobile-menu-button').addEventListener('click', function() {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    });
    
    // Tab functionality
    function showTab(tabName) {
      // Hide all content
      document.getElementById('content-case').classList.add('hidden');
      document.getElementById('content-hints').classList.add('hidden');
      document.getElementById('content-submission').classList.add('hidden');
      
      // Remove active class from all tabs
      document.getElementById('tab-case').classList.remove('border-b-2', 'border-primary');
      document.getElementById('tab-hints').classList.remove('border-b-2', 'border-primary');
      document.getElementById('tab-submission').classList.remove('border-b-2', 'border-primary');
      
      // Show selected content and activate tab
      document.getElementById('content-' + tabName).classList.remove('hidden');
      document.getElementById('tab-' + tabName).classList.add('border-b-2', 'border-primary');
    }
    
    // Hint modal functionality
const usedHints = {};

  function showHint(hintId, hintTitle) {
    if (usedHints[hintId]) {
      displayHintModal(hintTitle, usedHints[hintId]);
      return;
    }

    fetch(`/use-hint/${hintId}/`)
      .then(res => {
        if (!res.ok) throw new Error("Not enough points");
        return res.json();
      })
      .then(data => {
        if (data.error) {
          alert(data.error);
          return;
        }

        const hintContent = data.hint_html;
        usedHints[hintId] = hintContent; // Save it so we don't refetch
        displayHintModal(hintTitle, hintContent);
      })
      .catch(err => {
        alert(err.message);
      });
  }

  function displayHintModal(hintTitle, content) {
    const modal = document.getElementById('hint-modal');
    const titleEl = document.getElementById('hint-title');
    const body = document.getElementById('hint-body');

    titleEl.textContent = `${hintTitle} Results`;
    body.innerHTML = content;

    modal.classList.remove('hidden');
  }
    
    function closeHintModal() {
      document.getElementById('hint-modal').classList.add('hidden');
    }
    
    // Submission functionality
    function submitDiagnosis(event) {
      event.preventDefault();
      document.getElementById('submission-form').classList.add('hidden');
      document.getElementById('submission-result').classList.remove('hidden');
    }
  </script>
</body>
</html>
